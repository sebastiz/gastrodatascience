<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Organise Bookings</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Gastroenterology Data Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Wrangling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Data Acquisition</li>
    <li>
      <a href="Data_Import.html">Data Importing</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Cleaning</li>
    <li>
      <a href="FormatDates.html">Formatting Dates</a>
    </li>
    <li>
      <a href="Text_Clean.html">Text find and replace with gsub and stringr</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Merging</li>
    <li>
      <a href="Data_merge.html">Endoscopic-Pathological examples</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Accordionisation</li>
    <li>
      <a href="WranglingDataFromDataMutate.html">Creating data from data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Grouping</li>
    <li>
      <a href="GroupByDates.html">Grouping by dates</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="Wrangling_Tidy.html">Data Tidying </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="divider"></li>
    <li class="dropdown-header">Statistics</li>
    <li>
      <a href="StatisticsExploratoryDataAnalysis.html">Exploratory Data Analysis</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Numeric Statistics</li>
    <li>
      <a href="StatisticsCorrelations.html">Looking for associations- correlations</a>
    </li>
    <li>
      <a href="DataAnalysisStatsDiffMeans.html">Looking for differences</a>
    </li>
    <li>
      <a href="DataAnalysisEventingsSankey.html">Regression-uni and multivariate</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Categorical Statistics</li>
    <li class="divider"></li>
    <li class="dropdown-header">Text Mining</li>
    <li>
      <a href="Data_Analysis_Text_NLP.html">Natural Language Programming</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Visualisations</li>
    <li>
      <a href="StatisticsBasicDescriptivePlots.html">Some basic univariate plots</a>
    </li>
    <li>
      <a href="DataVisualisationsggplot.html">ggPlots and ggedit</a>
    </li>
    <li>
      <a href="DataAnalysisEventingsSankey.html">Patient flow</a>
    </li>
    <li>
      <a href="DataAnalysisTimeSeries.html">Time series analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Cornerstone Questions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="CornerstonesIntro.html">Introduction to Cornerstone Questions</a>
    </li>
    <li>
      <a href="PrepreparedEndoHistData.html">The preprepared Dataset</a>
    </li>
    <li>
      <a href="Cornerstone_Surveillance.html">Surveillance</a>
    </li>
    <li>
      <a href="Cornerstone_EndoscopicPerformance.html">Endoscopic Performance</a>
    </li>
    <li>
      <a href="Cornersteon_EndoPath.html">Diagnostic and Therapeutic Performance</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Management</li>
    <li>
      <a href="Appointments.html">Appointments</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Meta</li>
    <li>
      <a href="Meta_Workflow.html">Code workflow</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Organise Bookings</h1>

</div>


<div id="retrospective-bookings" class="section level2">
<h2>Retrospective bookings:</h2>
<p>Inevitably, if you are a gastroenterologist, you are going to have to organise your department somehow. This is usually a total nightmare and involves having little access to data and usually flying by the seat of your pants….but does it have to be like this? Most hospitals have some kind of electronic booking system for appointments and this records every patient episode where a booking has been made. It often records when a patient has not attended, or has been cancelled an appointment, and is obviously organised around the date of the booking episode. What a rich resource.</p>
<p>In general the flow of patients coming to see gastroenterologists, and doctors in general, goes like this:</p>
<p><br><br></p>
<div class="figure">
<img src="figures/Administration.png" />

</div>
<p><br><br></p>
<p>And once we understand the flow, we can start to develop a framework to measure the flow through the system.</p>
<p>You need, of course, to be able to access and download the data you are interested in. For example, I can access gastroenterology data for all appointments within any timeframe. I then specify the service I am interested in, in gastroenterology by specifying the service I am interested in (ie physiology, or outpatients in hepatology etc). My data looks like this:</p>
<pre class="r"><code>library(lubridate)
#Lets generate some hospital numbers
HospNumId&lt;-sample(paste(sample(letters[1:4]),sample(seq(1000000, 9999999),size=1000),sep=&quot;&quot;))
#Lets generate some appointment dates which also have time 
ApptDate&lt;-sample(seq(as.Date(&#39;2013/02/01&#39;), as.Date(&#39;2013/03/01&#39;), by=&quot;day&quot;),replace=T, 1000)
Time&lt;-paste(sample(9:15,1000,replace=T),&quot;:&quot;,sample(seq(0,59,by=15),1000,replace=T),sep=&quot;&quot;)             
FinalPOSIXApptDate&lt;-as.POSIXct(paste(ApptDate,&quot; &quot;,Time,sep=&quot;&quot;))

#Lets generate the dates when appointments were actually booked
ApptDateBooked&lt;-sample(seq(as.Date(&#39;2013/01/01&#39;), as.Date(&#39;2013/01/31&#39;), by=&quot;day&quot;),replace=T, 1000)
TimeBooked&lt;-paste(sample(9:15,1000,replace=T),&quot;:&quot;,sample(seq(0,59,by=15),1000,replace=T),sep=&quot;&quot;)             
FinalPOSIXBookedDate&lt;-as.POSIXct(paste(ApptDateBooked,&quot; &quot;,TimeBooked,sep=&quot;&quot;))


#Lets generate some test types
TestType&lt;-sample(c(&quot;Oesophageal Lab&quot;,&quot;Breath Tests&quot;,&quot;Manometry only&quot;),1000,replace=T)
#And some outcomes
Outcome&lt;-sample(c(&quot;DNA&quot;,&quot;Cancelled By Patient&quot;,&quot;Cancelled by Provider&quot;,&quot;Patient seen&quot;),1000,replace=T)
Appts&lt;-data.frame(HospNumId,TestType,FinalPOSIXBookedDate,FinalPOSIXApptDate,Outcome)</code></pre>
</div>
<div id="outcomes-of-bookings" class="section level2">
<h2>Outcomes of bookings:</h2>
<p>We can start our metrics by looking at point 1 and 2- what happens to patients booked for an appointment and what is the appointment utilization compared with this. With this dataset I can do some straightforward visualisations of what has been going on in the unit over, in this case, the previous month, (or over the previous 10 years to show how demand has changed if I wanted).</p>
<p>Of course I want to also know the following because it affects how we get paid….How many cancellations have there been, how many DNAs, and how many attended. This is easy to do. We just need to create a table by week and appointment outcome as follows</p>
<pre class="r"><code>summAT&lt;-as.matrix(table(Appts$Outcome,Appts$TestType))
kable(summAT)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Breath Tests</th>
<th align="right">Manometry only</th>
<th align="right">Oesophageal Lab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cancelled By Patient</td>
<td align="right">99</td>
<td align="right">76</td>
<td align="right">105</td>
</tr>
<tr class="even">
<td>Cancelled by Provider</td>
<td align="right">81</td>
<td align="right">97</td>
<td align="right">76</td>
</tr>
<tr class="odd">
<td>DNA</td>
<td align="right">76</td>
<td align="right">75</td>
<td align="right">88</td>
</tr>
<tr class="even">
<td>Patient seen</td>
<td align="right">79</td>
<td align="right">75</td>
<td align="right">73</td>
</tr>
</tbody>
</table>
<p><br><br></p>
<p>This can also be visualised:</p>
<p><br><br></p>
<pre class="r"><code>ggplot(Appts,aes(x=week(FinalPOSIXApptDate),fill=Outcome))+geom_histogram(binwidth = 1)+
  labs(title=&quot;Facet plot of attendance type by session code in the oesophageal physiology lab for the last 4 weeks from report run date&quot;) +
  facet_grid(TestType ~ .)</code></pre>
<p><img src="Appointments_files/figure-html/Appointments_OutcomeMatric_ggplot-1.png" width="672" /></p>
<p><br><br></p>
</div>
<div id="examination-of-appointment-usage" class="section level2">
<h2>Examination of appointment usage</h2>
<p>I am also obviously keen to organise the department so that we can make use of all appointments and not waste any. I want to see how many appointments we have booked in for the next month in the monrning and the afternoon. I will make use of the nice heatmap provided by the <a href="https://cran.r-project.org/web/packages/pheatmap/pheatmap.pdf">pheatmap package</a> to make this easier to visualise:</p>
<pre class="r"><code>library(lubridate)

#Tabulate the data so we can see how many patients are booked into each time slot

MyAppts&lt;-data.frame(table(Appts$FinalPOSIXBookedDate,Appts$TestType))
MyAppts$HourMin&lt;-hour(ymd_hms(MyAppts$Var1)) + minute(ymd_hms(MyAppts$Var1))/60
MyAppts$Day&lt;-day(as.Date(MyAppts$Var1))

#Now lets create a kind of heatmap with geom_tile:

ggplot(MyAppts, aes(x=HourMin, y=Day, fill=Freq))+ 
  geom_tile(color=&quot;white&quot;, size=0.1)+ 
  facet_wrap(~Var2, ncol=2)+
  geom_text(label=MyAppts$Freq)+
  scale_fill_gradient(low=&quot;green&quot;,high=&quot;darkgreen&quot;)+
labs(x=NULL, y=NULL, title=&quot;Events per weekday &amp; time of day&quot;)+
  theme(plot.title=element_text(hjust=0))+
  theme(axis.ticks=element_blank())+
  theme(axis.text=element_text(size=7))+
  theme(legend.title=element_text(size=8))+
  theme(legend.text=element_text(size=6))</code></pre>
<p><img src="Appointments_files/figure-html/Appointments_Available-1.png" width="672" /></p>
<p>So now I know how busy we are going to be. But hang on, there are some empty slots, for whatever reason. Why don’t I see who has been waiting a long time to undergo their physiology testing, and move them forward.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
