<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Workflow</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Gastroenterology Data Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Wrangling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Data Acquisition</li>
    <li>
      <a href="Data_Import.html">Data Importing</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Cleaning</li>
    <li>
      <a href="FormatDates.html">Formatting Dates</a>
    </li>
    <li>
      <a href="Text_Clean.html">Text find and replace with gsub and stringr</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Merging</li>
    <li>
      <a href="Data_merge.html">Endoscopic-Pathological examples</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Accordionisation</li>
    <li>
      <a href="WranglingDataFromDataMutate.html">Creating data from data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Grouping</li>
    <li>
      <a href="GroupByDates.html">Grouping by dates</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="Wrangling_Tidy.html">Data Tidying </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="divider"></li>
    <li class="dropdown-header">Statistics</li>
    <li>
      <a href="StatisticsExploratoryDataAnalysis.html">Exploratory Data Analysis</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Numeric Statistics</li>
    <li>
      <a href="StatisticsCorrelations.html">Looking for associations- correlations</a>
    </li>
    <li>
      <a href="DataAnalysisStatsDiffMeans.html">Looking for differences</a>
    </li>
    <li>
      <a href="DataAnalysisEventingsSankey.html">Regression-uni and multivariate</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Categorical Statistics</li>
    <li class="divider"></li>
    <li class="dropdown-header">Text Mining</li>
    <li>
      <a href="Data_Analysis_Text_NLP.html">Natural Language Programming</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Visualisations</li>
    <li>
      <a href="StatisticsBasicDescriptivePlots.html">Some basic univariate plots</a>
    </li>
    <li>
      <a href="DataVisualisationsggplot.html">ggPlots and ggedit</a>
    </li>
    <li>
      <a href="DataAnalysisEventingsSankey.html">Patient flow</a>
    </li>
    <li>
      <a href="DataAnalysisTimeSeries.html">Time series analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Cornerstone Questions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="CornerstonesIntro.html">Introduction to Cornerstone Questions</a>
    </li>
    <li>
      <a href="PrepreparedEndoHistData.html">The preprepared Dataset</a>
    </li>
    <li>
      <a href="Cornerstone_Surveillance.html">Surveillance</a>
    </li>
    <li>
      <a href="Cornerstone_EndoscopicPerformance.html">Endoscopic Performance</a>
    </li>
    <li>
      <a href="Cornersteon_EndoPath.html">Diagnostic and Therapeutic Performance</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Management</li>
    <li>
      <a href="Appointments.html">Appointments</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Meta</li>
    <li>
      <a href="Meta_Workflow.html">Code workflow</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Workflow</h1>

</div>


<div id="how-to-write-r-scripts-and-the-workflow-needed" class="section level2">
<h2>How to write R Scripts and the workflow needed</h2>
<p>This section explains the principles of a code workflow so that you can template your scripts as much as possible. In general one script should do one thing and have one output rather than many. This will make the script considerably easier to readAs reflected in the construction of this site.</p>
<pre class="r"><code>######################################### Data acquisiton######################################### 
#This is where the data is imported

######################################### Data merging######################################### 
#This is where external datasets are merged with the current dataset. This can be done after cleaning as well especially if you need to clean dates etc.

######################################### Data cleaning######################################### 
#Self explanatory
######################################### Data accordionisation#########################################
#This is where new columns containing extrapolated data are created</code></pre>
<p>I usually spend a lot of time defining the subsets of data I will be working on. Experience has shown me that I am capable of creating many subsets and then getting confused about which ones I am trying to manipulate so it’s best to be explicit about what you are using here. I separate each defined subset (which are named intelligenetly and intuitively) with a series of ‘########’ so I can navigate through them easily. I also create labels for each subset which I will use in the diagrammeR</p>
<pre class="r"><code>######################################### Data forking (filtering and subsetting)######################################### 
#1. All Filters should be numeric nrows and start with the term Fil_ appended to the nrow from which it is derived eg mydf becomes Fil_mydf&lt;-nrow(mydf)
#Also need the original dataset that it comes from so data lineage is maintained


#This is where subsets of the data for later analysis are created. I also label the datasets for use in diagrammeR later so I can get an overview of my methodology. All the subsets should be created here and the parent dataset should also be labelled here.</code></pre>
<pre class="r"><code>######################################### Data analysis######################################### 
#All the data analysis can be done here</code></pre>
</div>
<div id="code-documentation" class="section level2">
<h2><strong>Code documentation</strong></h2>
<p>One of the most important aspects of writing scripts is being able to forget about them and then when you need to change something, immediately understanding the script. THis relies on good documentation of the script and excellent commenting detailing what each step is doing. It is a pain at the time but nothing like the pain of trying to decipher what you have done later on.</p>
<p>Apart from commenting I find getting an overview of what I have done, and how I have subsetted the data to also be extremely useful. For this I use the packages <a href="http://rich-iannone.github.io/DiagrammeR/">diagrammeR</a> and <a href="https://cran.r-project.org/web/packages/CodeDepends/index.html">codeBender</a> as per below</p>
<p><br><br></p>
<div id="subset-documentation" class="section level3">
<h3><strong>Subset documentation</strong></h3>
<p><strong>Always start the filter with the data source document</strong></p>
<pre class="r"><code>library(DiagrammeR)
    #Create the labels for the DiagrammeR plot: Always append Lab_ prior to using the filter value eg Lab_Fil_OGD&lt;-paste(&quot;The subsetN&quot;,Fil_OGD, sep = &quot;: &quot;)
    Lab_Fil_Data1&lt;-paste(&quot;The filter&quot;,20, sep = &quot;: &quot;)
    Lab_Fil_Data2&lt;-paste(&quot;The filter&quot;,34, sep = &quot;: &quot;)
    Lab_Fil_Data3&lt;-paste(&quot;The filter&quot;,25, sep = &quot;: &quot;)
    
    Lab_Fil_All.df&lt;-paste(&quot;All&quot;,22, sep = &quot;: &quot;)
    Lab_Fil_OesophLab&lt;-paste(&quot;OesophLab&quot;,82, sep = &quot;: &quot;)

    #I always create a label here so I know where the original data source was in the first place:
    Lab_Fil_Source&lt;-&quot;Mydata.xls&quot;
   
    
#Now create the nodes
    nodes &lt;- create_nodes_df(nodes=3,
                          nodes = c(Lab_Fil_Source,Lab_Fil_All.df,Lab_Fil_OesophLab),                     
                          label = TRUE,
                          fontsize = 55,
                          fontcolour = &quot;White&quot;,
                          type = &quot;lower&quot;,
                          style = &quot;filled&quot;,
                          color = &quot;aqua&quot;,
                          shape = c(&quot;circle&quot;),
                          x = c(0,0,0,0,0),
                          y = c(600,300,0,-300,-600,-900))
    
#This is the complicated part as you have to tie the labels up together
    edges &lt;- create_edges_df(from = c(1,2), 
                          to = c(2,3),
                          #rel = c(nrow(MyBariumDataAll), nrow(MyBariumDataSwall), nrow(MyBariumDataWithHRMAny), nrow(MyBariumDataWithHRMD)),
                          arrowhead = rep(&quot;normal&quot;, 60),
                          # color = c(&quot;red&quot;, &quot;red&quot;, &quot;red&quot;, &quot;red&quot;, &quot;red&quot;, &quot;red&quot;),
                          length = c(500,200,50,50),
                          fontsize = 55)

graph &lt;-
  create_graph(
    nodes_df = nodes,
    edges_df = edges)


#Unfortunately I can&#39;t get this to work in rmarkdown but it should work in Rstudio
#render_graph(graph)</code></pre>
<p><br><br></p>
</div>
<div id="code-documentation-1" class="section level3">
<h3><strong>Code documentation</strong></h3>
<p>This <a href="https://cran.r-project.org/web/packages/CodeDepends/index.html">library</a> allows you to get an overview of your code. It is incredibly useful especially when your code base is large:</p>
<pre class="r"><code>library(CodeDepends)
sc = readScript(&quot;Meta_Workflow.Rmd&quot;)
g = makeVariableGraph( info =getInputs(sc))
if(require(Rgraphviz))
zz = layoutGraph(g)
graph.par(list(nodes = list(fontsize = 36)))
renderGraph(zz)</code></pre>
<p><img src="Figs/unnamed-chunk-6-1.png" width="1152" /></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
